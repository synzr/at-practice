{% extends 'base.html.twig' %}

{% block title %}Список задач{% endblock %}

{% block body %}
<div data-controller="modals">
    <main class="container-sm">
        <section class="container-fluid">
            <h1>Список задач</h1>
        </section>

        {# Фильтры #}
        <section class="container-fluid mb-3" data-controller="options">
            <form method="get" id="filter-form" data-options-target="form">
                <div class="row g-2">
                    <div class="col-md-3">
                        <select name="status" class="form-select" data-action="change->options#update">
                            <option value="all"{{ filter.status == 'all' ? ' selected' : '' }}>Все задачи</option>
                            <option value="active"{{ filter.status == 'active' ? ' selected' : '' }}>Активные</option>
                            <option value="completed"{{ filter.status == 'completed' ? ' selected' : '' }}>Выполненные</option>
                            <option value="deleted"{{ filter.status == 'deleted' ? ' selected' : '' }}>Удаленные</option>
                        </select>
                    </div>

                    <div class="col-md-2">
                        <input
                            type="date"
                            name="deadline_from"
                            class="form-control"
                            placeholder="От даты"
                            value="{{ filter.deadline_from }}"
                            data-action="change->options#update"
                        >
                    </div>

                    <div class="col-md-2">
                        <input
                            type="date"
                            name="deadline_to"
                            class="form-control"
                            placeholder="До даты"
                            value="{{ filter.deadline_to }}"
                            data-action="change->options#update"
                        >
                    </div>

                    <div class="col-md-2">
                        <select name="sort" class="form-select" data-action="change->options#update">
                            <option value="all"{{ sort.field == 'id' ? ' selected' : '' }}>По идентификатору</option>
                            <option value="created_at"{{ sort.field == 'created_at' ? ' selected' : '' }}>По дате создания</option>
                            <option value="deadline"{{ sort.field == 'deadline' ? ' selected' : '' }}>По дедлайну</option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <select name="order" class="form-select" data-action="change->options#update">
                            <option value="asc"{{ sort.order == 'asc' ? ' selected' : '' }}>По возрастанию</option>
                            <option value="desc"{{ sort.order == 'desc' ? ' selected' : '' }}>По убыванию</option>
                        </select>
                    </div>
                </div>
            </form>
        </section>

        {# Панель действий #}
        <section class="container-fluid d-flex flex-row-reverse gap-1 mb-3">
            <button
                class="btn btn-primary"
                data-action="click->modals#openCreateModal"
            >
                Добавить задачу
            </button>
        </section>

        <section
            class="container-fluid row"
            data-controller="grid"
            data-modals-target="grid"
        >
            {% include 'task/_tasks.html.twig' with { tasks: tasks } %}
        </section>

    </main>

    {# Модал задачи #}
    <div class="modal fade" data-modals-target="taskModal" tabindex="-1" aria-labelledby="taskModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskModalLabel" data-modals-target="title">Добавить задачу</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                {{ form_start(form, {
                    attr: {
                        id: 'task-form',
                        'data-modals-target': 'form',
                        'data-action': 'submit->modals#submitForm'
                    },
                }) }}
                    <div class="modal-body">
                        {{ form_row(form.name) }}
                        {{ form_row(form.description) }}
                        {{ form_row(form.deadline) }}
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" data-modals-target="submit">Создать</button>
                    </div>
                {{ form_end(form) }}
            </div>
        </div>
    </div>

    {# Модал подтверждения #}
    <div class="modal fade" data-modals-target="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true" data-controller="confirm-delete">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmModalLabel">Подтверждение</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Вы уверены, что хотите удалить задачу без возможности восстановления?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteButton" data-action="click->modals#delete" data-modals-target="confirmSubmit">Удалить</button>
                </div>
            </div>
        </div>
    </div>
</div>

{# Контейнер тостов #}
<div data-controller="toast" class="toast-container position-fixed bottom-0 end-0 p-4">
    <template id="toastTemplate" data-toast-target="template">
        <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">MESSAGE</div>
                <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </template>
</div>
{% endblock %}
